<!DOCTYPE html>
<html>
<head>
    <title>Редактирование учебного плана</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
</head>
<body>
    
    
    <div class="content" id="content">
        <h1>Редактировать</h1>
        <form id="editStudyPlanForm" action="/study_plans/edit/{{studyPlan.id}}" method="post" enctype="multipart/form-data">
            <div class="input-field">
                <input type="text" id="title" name="title" value="{{studyPlan.title}}" required>
                <label for="title" class="active">Название</label>
            </div>
            <div class="input-field">
                <textarea id="description" name="description" class="materialize-textarea" required>{{studyPlan.description}}</textarea>
                <label for="description" class="active">Описание</label>
            </div>
            <div class="input-field">
                <select id="subjectid" name="subjectid" required>
                    <!-- Options will be populated by JavaScript -->
                </select>
                <label for="subjectid" class="active">Предмет</label>
            </div>
            <div class="input-field">
                <select id="classid" name="classid" required>
                    <!-- Options will be populated by JavaScript -->
                </select>
                <label for="classid" class="active">Класс</label>
            </div>
            <div class="file-field input-field">
                <div class="btn">
                    <span>Заменить файл</span>
                    <input type="file" id="newFile" name="newFile">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Выберите файл">
                </div>
            </div>
            <input type="submit" value="Сохранить" class="btn">
            <button type="button" onclick="location.href='/study_plans'" class="btn">Вернуться назад</button>
        </form>
    </div>

    <script>
        $(document).ready(function() {

            M.updateTextFields(); // Update text fields for Materialize
            $('select').formSelect();

            // Fetch available subjects and classes
            $.get('/study_plans/subjects', function(data) {
                data.forEach(subject => {
                    $('#subjectid').append(`<option value="${subject.id}">${subject.name}</option>`);
                });
                $('#subjectid').val('{{studyPlan.subjectid}}'); // Set the current value
                $('select').formSelect();
            });

            $.get('/study_plans/classes', function(data) {
                data.forEach(cls => {
                    $('#classid').append(`<option value="${cls.id}">${cls.name}</option>`);
                });
                $('#classid').val('{{studyPlan.classid}}'); // Set the current value
                $('select').formSelect();
            });

            // Handle form submission using AJAX
            // Handle form submission using AJAX
            $('#editStudyPlanForm').submit(function(e){
                e.preventDefault();
                var formData = new FormData($(this)[0]);

                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(data){
                        M.toast({html: 'Учебный план успешно обновлен', classes: 'rounded'});
                        setTimeout(function(){
                            window.location.href = '/study_plans';
                        }, 3000); // Redirect after 3 seconds
                    },
                    error: function(jqXHR){
                        var message = jqXHR.responseJSON ? jqXHR.responseJSON.message : 'Ошибка при обновлении учебного плана';
                        M.toast({html: message, classes: 'rounded red lighten-1'});
                    }
                });
            });
             
        });
            function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const header = document.getElementById('header');
            const content = document.getElementById('content');
            sidebar.classList.toggle('visible');
            header.classList.toggle('sidebar-open');
            content.classList.toggle('sidebar-open');
        }

            function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const header = document.getElementById('header');
            const content = document.getElementById('content');
            sidebar.classList.remove('visible');
            header.classList.remove('sidebar-open');
            content.classList.remove('sidebar-open');

           

        }
    </script>
</body>
</html>